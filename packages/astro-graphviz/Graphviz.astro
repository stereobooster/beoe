---
import {
  renderGraphviz,
  type RenderGraphvizOptions,
} from "@beoe/rehype-graphviz";
import { getCache } from "@beoe/cache";
import { serialize } from "node:v8";

const cache = await getCache();

interface Props extends RenderGraphvizOptions {}

let svg: string;
const cacheKey = serialize(Astro.props);
svg = cache.get(cacheKey);
if (svg === undefined) {
  svg = await renderGraphviz(Astro.props);
  cache.set(cacheKey, svg);
}
---

<Fragment set:html={svg} />
