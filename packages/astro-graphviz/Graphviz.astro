---
import { processGraphvizSvg } from "@beoe/rehype-graphviz";
// Error: Command failed with exit code 1. (no details)
// import { serialize } from "node:v8";
// import { getCache } from "@beoe/cache";

import { Graphviz } from "@hpcc-js/wasm";
const graphviz = await Graphviz.load();

// const cache = await getCache();

interface Props {
  code: string;
  class?: string;
}

let svg: string;
// const cacheKey = serialize(Astro.props);
// svg = cache.get(cacheKey);
// if (svg === undefined) {
svg = processGraphvizSvg(graphviz.dot(Astro.props.code), Astro.props.class);
//   cache.set(cacheKey, svg);
// }
---

<Fragment set:html={svg} />
